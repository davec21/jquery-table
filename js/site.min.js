/*!
 * Start Bootstrap - Agency v3.3.7+1 (http://startbootstrap.com/template-overviews/agency)
 * Copyright 2013-2017 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap/blob/gh-pages/LICENSE)
 */
function init(){$.ajax({type:"get",url:"https://api.myjson.com/bins/1fwclf",dataType:"json",success:function(t){console.log("Data fetched successfully. Begin parse.",t),createTable("edit-table",t),createForm("myModal .modal-body",t)}}),$("tbody").sortable({update:function(t,a){rowDropped(a.item.startPos,a.item.index())},start:function(t,a){a.item.startPos=a.item.index()}}),$(".modal").on("hidden.bs.modal",function(t){fillTableRows("edit-table")})}function createForm(t,a){var e=$("#"+t);e.html("");for(var n=0;n<a.columns.length;n++){var o=document.createElement("div");o.setAttribute("class","form-group"),$(o).html('<label for="exampleInputEmail1">'+a.columns[n].name+"</label>");var l=createInput(n,0);l.setAttribute("class","form-control"),l.setAttribute("id","dval-"+n),o.appendChild(l),e.append(o)}}function createTable(tableDiv,data){var tableEle=$("#"+tableDiv+" > thead");jsonData=data;var header='<tr><th class="dark"></th>';data.columns.forEach(function(column){var cache={};column.validationFunc?eval("cache.validationFunc = "+column.validationFunc):"json"===column.datatype&&(cache.validationFunc=validateJsonInput),column._cache=cache,header+='<th class="dark">'+column.name+"</th>"}),header+="</tr>",tableEle.html(header),fillTableRows(tableDiv)}function fillTableRows(t){var a=$("#"+t+" > tbody");a.html("");for(var e=0;e<jsonData.data.length;e++){var n=document.createElement("tr");n.setAttribute("id","row-"+e);var o=document.createElement("td");o.setAttribute("class","dark"),$(o).html(e+1),n.appendChild(o);for(var l=0;l<jsonData.columns.length;l++){var d=document.createElement("td");d.appendChild(createInput(l,e)),n.appendChild(d)}a.append(n)}}function createInput(t,a){var e=jsonData.columns[t],n=jsonData.data[a],o=n[t];o||(o="");var l;if(e.input){if("select"===e.input.type){var d=e.input.data.values,r=e.input.data.displays;l=document.createElement("select"),l.setAttribute("onchange","endEdit(this)");for(var i=0;i<d.length;i++){var s=document.createElement("option");s.setAttribute("value",d[i]),d[i]===o&&s.setAttribute("selected","true"),$(s).html(r[i]),l.appendChild(s)}}}else{switch(l=document.createElement("input"),l.setAttribute("ondblclick","editRow("+a+")"),l.setAttribute("onblur","endEdit(this)"),e.datatype){case"string":l.setAttribute("type","text");break;case"json":""!==o&&(o=JSON.stringify(o)),l.setAttribute("type","text");break;case"number":l.setAttribute("type","number");break;case"date":l.setAttribute("type","date")}l.setAttribute("value",o)}return l.setAttribute("class","bound-value"),l.setAttribute("data-col",t),l.setAttribute("data-row",a),l.setAttribute("data-old",o),l.setAttribute("ondblclick","editRow("+a+")"),l.setAttribute("onkeydown","keyDown(event)"),l.setAttribute("tabIndex",t+1+a*jsonData.columns.length),l}function addNewRow(){var t=jsonData.data.push(new Array(jsonData.columns.length));addRowToTable(t-1)}function deleteRow(t){jsonData.data.splice(t,1),fillTableRows("edit-table")}function editRow(t){editRowId=t;for(var a=jsonData.columns,e=0;e<a.length;e++){var n=jsonData.data[t][e];""!=n&&"json"===a[e].datatype&&(n=JSON.stringify(n));var o=$("#dval-"+e);o.val(n),o.attr("data-col",e),o.attr("data-row",t),o.attr("data-old",n)}$("#myModal").modal("show")}function endEdit(t){var a=$(t);if(a){var e=a.attr("data-col"),n=a.attr("data-row"),o=jsonData.columns[e],l=a.attr("data-old"),d=a.val();if(l!==d&&!validateInput(d,o))return a.css("border","2px solid red"),a.focus(),void(hasInvalidField=!0);"json"===o.datatype&&d.length>0&&(d=JSON.parse(d)),a.css("border",""),jsonData.data[n][e]=d,a.attr("data-old",d),hasInvalidField=!1}}function cancelEdit(t){var a=$(t);a.val(a.attr("data-old"))}function nextRow(){if(!hasInvalidField){var t=editRowId+1;t>=jsonData.data.length&&(t=jsonData.data.length-1),editRow(t)}}function previousRow(){if(!hasInvalidField){var t=editRowId-1;t<0&&(t=0),editRow(t)}}function validateInput(t,a){return!a._cache.validationFunc||a._cache.validationFunc(t)}function validateJsonInput(t){if(!t)return!1;try{JSON.parse(t);return!0}catch(a){return console.log(a),!1}}function rowDropped(t,a){if(t!==a){var e=jsonData.data[t];jsonData.data.splice(t,1),jsonData.data.splice(a,0,e),fillTableRows("edit-table")}}function keyDown(t){"Escape"===t.key?cancelEdit(t.target):"Delete"===t.key&&deleteRow($(t.target).attr("data-row"))}var jsonData={},editRowId=0,hasInvalidField=!1,currTabIndex=0;